<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="FD" />


<title>TousAntiCovid</title>

<script src="TAC_files/header-attrs-2.7/header-attrs.js"></script>
<script src="TAC_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="TAC_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="TAC_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="TAC_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="TAC_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="TAC_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="TAC_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="TAC_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="TAC_files/navigation-1.1/tabsets.js"></script>
<script src="TAC_files/navigation-1.1/codefolding.js"></script>
<link href="TAC_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="TAC_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">TousAntiCovid</h1>
<h4 class="author">FD</h4>

</div>


<div id="data" class="section level1">
<h1>Data</h1>
<ul>
<li>TousAntiCovid: <a href="https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/">open data, official source</a></li>
<li>Epidemic data:
<ul>
<li><a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series">JHU data</a>, because recorded as function of date of the result’s announcement.</li>
<li><a href="https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71">data.gouv.fr</a>, dataset which used by JHU, for which date corresponds to the date of declaration and not date of test</li>
</ul></li>
</ul>
<pre class="r"><code># Load and format data

# 1) TAC
# Data Source : https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/
# URL of the data on data.gouv.fr
URL &lt;- &quot;https://www.data.gouv.fr/fr/datasets/r/0e2168ec-24c7-4b49-a900-c7dd12f8e88c&quot;

# Download and read data
today &lt;- Sys.Date() # today&#39;s date
dataFile &lt;- paste0(&quot;data/TAC_&quot;, today, &quot;.csv&quot;) # name file with today&#39;s date
if(dlData){
  download.file(URL, dataFile) # download file from repo
}
dat &lt;- read.csv(dataFile)

## Description from the website (2020-12-23)
## Le présent jeu de données informe pour chaque jour depuis le lancement de l&#39;application le 2 juin 2020 :
##
## Total cumulé du nombre d&#39;applications enregistrées moins le nombre de désenregistrements.
## Total cumulé d’utilisateurs notifiés par l’application : le nombre d’utilisateurs notifiés par l’application comme contacts à risque suite à une exposition à la COVID-19, depuis le 2 juin 2020.
## Total cumulé d’utilisateurs se déclarant comme des cas de COVID-19 par jour : le nombre d’utilisateurs qui se sont déclarés comme des cas de COVID-19 dans l’application, depuis le 2 juin 2020.

# Check data
# Time differences between dates
unique(diff(as.Date(dat$date))) # -&gt; there are some gaps in the data

# New columns with delta between dates
dat$diffDate &lt;- c(NA, diff(as.Date(dat$date))) # Difference in days between data points
# for the other columns, divide by the time difference to have differences per day
# (otherwise data not comparable when different time differences)
dat$diffRegisterPerDay &lt;- c(NA, diff(dat$register) / dat$diffDate[-1]) 
dat$diffQRPerDay &lt;- c(NA, diff(dat$qrCode) / dat$diffDate[-1])
dat$diffNotifPerDay &lt;- c(NA, diff(dat$notified) / dat$diffDate[-1])

# Create new dataset without gaps in the dates
# New dates, without gaps
rangeDates &lt;- range(as.Date(dat$date))
allDates &lt;- seq(rangeDates[1], rangeDates[2], by=&quot;days&quot;)
dat.temp &lt;- as.data.frame(as.character(allDates))
names(dat.temp) &lt;- &quot;date&quot;

# Merge the datasets by date 
tmp &lt;- merge(dat, dat.temp, by = &quot;date&quot;, all = TRUE)
# note: this adds NA at the dates where there were no data; 
# these dates are put at the end of the table

# Sort the new dataset by date
sortedDateIndex &lt;- sort(as.character(tmp$date), index.return = TRUE)$ix
dat.all &lt;- tmp[sortedDateIndex, ]

# Add day of the week
dat.all$weekDay &lt;- weekdays(as.Date(dat.all$date))

# Load function to compute sliding average
source(&quot;commonFuncs.R&quot;)

# Remove negative values
dat.all$diffNotifPerDay[dat.all$diffNotifPerDay &lt; 0 ] &lt;- NA

# Compute the average values, 1-week window, focal point in the middle
dat.all$diffRegisterPerDay.WeekAve &lt;- sliding.ave(dat.all$diffRegisterPerDay)
dat.all$diffQRPerDay.WeekAve &lt;- sliding.ave(dat.all$diffQRPerDay)
dat.all$diffNotifPerDay.WeekAve &lt;- sliding.ave(dat.all$diffNotifPerDay)
dat.all$register.WeekAve &lt;- sliding.ave(dat.all$register)
dat.all$date &lt;- as.Date(dat.all$date)</code></pre>
<pre class="r"><code># 2) Data from JHU
# The date in these data is the date of the result&#39;s annoucement
URL &lt;- &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;
# Download and read data
dataFile &lt;- paste0(&quot;data/JHU_cases_all_&quot;, today, &quot;.csv&quot;) # name file with today&#39;s date
if(dlData){
  download.file(URL, dataFile) # download file from repo
}
datJHU &lt;- read.csv(dataFile, header = TRUE, check.names = FALSE)
# Extract data about France
datJHU.France &lt;- datJHU[datJHU$`Country/Region` == &quot;France&quot;, ]

# Collapse data for all France (including DOM TOM)
datJHU.France.agg &lt;- apply(datJHU.France[, -(1:4)], 2, sum)
# Need to reformat the data: have one column for dates and one column for values
datJHUFr &lt;- data.frame(matrix(0, ncol = 2, nrow = length(datJHU.France.agg)))
datJHUFr$date &lt;- as.Date(names(datJHU.France.agg), format = &quot;%m/%d/%y&quot;)
datJHUFr$cumP &lt;- unname(datJHU.France.agg)
datJHUFr &lt;- datJHUFr[, -(1:2)]
# Get week day
datJHUFr$weekDay &lt;- weekdays(as.Date(datJHUFr$date))
# Extract data per day (JHU provides cumulative values)
datJHUFr$P &lt;- c(datJHUFr[1, &quot;cumP&quot;], diff(datJHUFr$cumP))

# Turn negative values into NA
# (has to be done after diff are calculated to make sure corrections are taken into account)
datJHUFr[which(datJHUFr$P &lt; 0), &quot;P&quot;] &lt;- NA

# Add the sliding window value to the JHU data
# (after negative values have been turned into NAs)
datJHUFr$P.WeekAve &lt;- sliding.ave(datJHUFr$P, winwdt = 7, pos = 4, na.rm = TRUE)</code></pre>
<pre class="r"><code># 3) French data from data.gouv.fr, which JHU uses as source
URL &lt;- &quot;https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71&quot;
# Download and read data
dataFile &lt;- paste0(&quot;data/FR_cases_all_&quot;, today, &quot;.csv&quot;) # name file with today&#39;s date
if(dlData){
  download.file(URL, dataFile) # download file from repo
}
datFR &lt;- read.csv(dataFile, header = TRUE, check.names = FALSE)
datFR$date &lt;- as.Date(datFR$date)

# Get week day
datFR$weekDay &lt;- weekdays(as.Date(datFR$date))
# Extract data per day (dataset provides cumulative values)
datFR$P &lt;- c(datFR[1, &quot;total_cas_confirmes&quot;], diff(datFR$total_cas_confirmes))

# Turn negative values into NA
# (has to be done after diff are calculated to make sure corrections are taken into account)
datFR[which(datFR$P &lt; 0), &quot;P&quot;] &lt;- NA

# Add the sliding window value to the data
# (after negative values have been turned into NAs)
datFR$P.WeekAve &lt;- sliding.ave(datFR$P, winwdt = 7, pos = 4, na.rm = TRUE)</code></pre>
<p>Compare JHU and data.gouv.fr datasets (will use data.gouv.fr)</p>
<pre class="r"><code># Test: compare JHU and datFR
plot(datJHUFr$date, datJHUFr$P.WeekAve, xlab = &quot;Date&quot;, ylab = &quot;New cases, 7-day average&quot;)
points(datFR$date, datFR$P.WeekAve, col = &quot;blue&quot;, pch = 2)
legend(&quot;topleft&quot;, col = c(1, &quot;blue&quot;), pch = c(1, 2), legend = c(&quot;JHU&quot;, &quot;data.gouv.fr&quot;))</code></pre>
<p><img src="TAC_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># Merge the datasets
dat.withEpi &lt;- merge(dat.all, datFR, by = &quot;date&quot;)
names(dat.withEpi)[9] &lt;- &quot;weekDay&quot;</code></pre>
<p>Données TAC jusqu’au Tue 21 Dec 2021 (inclus)<br />
Données épidémio (JHU) jusqu’au Tue 21 Dec 2021 (inclus). Données épidémio (data.gouv.fr) jusqu’au Tue 21 Dec 2021 (inclus).</p>
<p>On utilise les données épidémio data.gouv.fr.</p>
<div id="quelques-dates-clés" class="section level2">
<h2>Quelques dates clés</h2>
<ul>
<li><p>StopCovid est devenu TousAntiCovid vers le 22 octobre 2020 <a href="https://www.gouvernement.fr/partage/11818-conference-de-presse-sur-l-application-des-mesures-contre-la-covid-19" class="uri">https://www.gouvernement.fr/partage/11818-conference-de-presse-sur-l-application-des-mesures-contre-la-covid-19</a></p></li>
<li><p>Une campagne de publicité a été lancée à la fin novembre / début décembre 2020 (avec envoi de SMS à la population)</p></li>
<li><p>Les critères de détection de contact ont changé le 27-28 novembre 2020 (changement distance et durée). <a href="https://www.service-public.fr/particuliers/actualites/A14486">Source</a></p></li>
<li><p>A partir du 16 décembre 2020, le QR code est plus facile à obtenir (envoi SMS). <a href="https://twitter.com/TousAntiCovid/status/1349013051387871235?s=20">Source</a>.</p></li>
<li><p>Nouveau critère encore de détection de contacts vers le 9 mars 2021.<br />
<a href="https://twitter.com/TousAntiCovid/status/1369668376709193730?s=20">Source</a>.</p></li>
<li><p>Problème de dédoublonnage : correction à partir du 20 mai 2021 <a href="https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-resultats-des-tests-virologiques-covid-19/">Source</a> &gt; A compter de ce jour, les indicateurs seront corrigés afin de supprimer l’effet doublon, lors de la réalisation de plusieurs tests de dépistage par une même personne. &gt; &gt; Depuis le début de la pandémie, la plateforme sécurisée Si-DEP enregistre tous les résultats des tests de dépistage. Afin de garantir la protection des données personnelles des personnes testées, chaque résultat était lié à l’émission d’un pseudo anonymisé. Cependant, avec l’apparition des variants sur le territoire, certaines personnes sont amenées à réaliser deux tests, jusqu’à présent comptabilisés deux fois. &gt; &gt; L’algorithme utilisé a donc récemment été mis à jour afin qu’il ne décompte qu’un seul patient lorsque celui-ci se fait tester plusieurs fois dans un intervalle de temps court, toujours en respectant l’anonymat. Grâce à cette nouvelle pseudonymisation, Santé publique France est capable de renforcer son efficacité et de produire des données encore plus précises, consultables chaque semaine dans son point épidémiologique.</p></li>
</ul>
<p>Les tests antigéniques ont été inclus à partir du 8 décembre 2020.</p>
<p>Ajout de l’information de la période des doublons dans les données</p>
<pre class="r"><code># Add information about the reliability of the count
# less reliable in the time interval where there were issues with duplicates
dat.withEpi$reliableEpi &lt;- TRUE 
idoublons &lt;- which(as.Date(dat.withEpi$date) &gt; as.Date(date_debutAg) &amp; as.Date(dat.withEpi$date) &lt;= as.Date(date_finDoublonAg))</code></pre>
<p>Annonce du pass sanitaire</p>
<pre class="r"><code>date_annonceMacron &lt;- &quot;2021-07-12&quot;</code></pre>
</div>
</div>
<div id="plots" class="section level1">
<h1>Plots</h1>
<pre class="r"><code># Load plot settings
source(&quot;commonPlot.R&quot;)</code></pre>
<pre class="r"><code>wk &lt;- seq(min(dat.withEpi$date), max(dat.withEpi$date), by = &quot;week&quot;)

plotXaxs &lt;- function(){
  axis(1, wk, labels = as.Date(wk), las = 3, cex.axis = 0.4)
}</code></pre>
<div id="tac-registrations" class="section level2">
<h2>TAC, registrations</h2>
<div id="number-of-registered-users-over-time" class="section level3">
<h3>Number of registered users, over time</h3>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$register, 
     xlab = &quot;date&quot;, 
     ylab = &quot;Registrations&quot;, 
     pch = 16, col = cols[dat.all$weekDay])</code></pre>
<p><img src="TAC_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="changes-in-number-of-registered-users-per-day" class="section level3">
<h3>Changes in number of registered users, per day</h3>
<p>(NB: when there is a gap in the data, the difference in number of users is divided by the length of the time gap)</p>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffRegisterPerDay, log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;delta registrations per day&quot;, 
     pch = 16, col = cols[dat.all$weekDay], 
     ylim = c(1, 7*10^5), 
     yaxs = &quot;i&quot;)
legend(as.Date(&quot;2020-07-01&quot;), y = 500000, legend = names(cols), col = cols, pch = 16, box.lwd = 0)
abline(v = as.Date(&quot;2020-10-22&quot;))</code></pre>
<p><img src="TAC_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The vertical line corresponds to the switch from StopCovid to TousAntiCovid. There was an advertisement campaign by the end of November/beginning of December, with SMS sent to the population.</p>
</div>
</div>
<div id="tac-qrcodes" class="section level2">
<h2>TAC, QRcodes</h2>
<div id="qr-codes-scanned-every-day" class="section level3">
<h3>QR codes scanned every day</h3>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffQRPerDay, log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;delta QR per day&quot;, 
     pch = 16, col = cols[dat.all$weekDay])
lines(dat.all$date, dat.all$diffQRPerDay.WeekAve, col = colAve)
legend(as.Date(&quot;2020-07-01&quot;), y = 2000, legend = c(names(cols),  &quot;7-day average&quot;), col = c(cols, colAve), pch = c(rep(16, 7), -1), box.lwd = 0, lwd = c(rep(0, 7), 1))</code></pre>
<p><img src="TAC_files/figure-html/QRCodesPerDay-1.png" width="672" /></p>
<p>The minima are on Sundays</p>
</div>
</div>
<div id="tac-notifications" class="section level2">
<h2>TAC, notifications</h2>
<div id="notifications-sent-every-day" class="section level3">
<h3>Notifications sent every day</h3>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffNotifPerDay, log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;delta notifications per day&quot;, 
     pch = 16, col = cols[dat.all$weekDay])

lines(dat.all$date, dat.all$diffNotifPerDay.WeekAve, col = colAve)

legend(as.Date(&quot;2020-07-01&quot;), y = 1000, legend = c(names(cols),  &quot;7-day average&quot;), col = c(cols, colAve), pch = c(rep(16, 7), -1), box.lwd = 0, lwd = c(rep(0, 7), 1))</code></pre>
<p><img src="TAC_files/figure-html/NotifsPerDay-1.png" width="672" /></p>
<p>The minima are on Mondays<br />
-&gt; There seems to be a one-day difference between scanned QR codes and notifications sent. This was already noticed by F. Lesueur <a href="https://flesueur.medium.com/réalignement-temporel-des-chiffres-tousanticovid-covid-7bda2f0bf1c1">here</a>.</p>
</div>
<div id="notifications-per-qr-code" class="section level3">
<h3>Notifications per QR code</h3>
<ol style="list-style-type: decimal">
<li>same day</li>
</ol>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffNotifPerDay / dat.all$diffQRPerDay, log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;notifs per QRcode&quot;, 
     pch = 16, col = cols[dat.all$weekDay], main = &quot;raw data, same day&quot;)</code></pre>
<p><img src="TAC_files/figure-html/NotifsPerQRCodeSameDay-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>one-day difference</li>
</ol>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffNotifPerDay / (c(NA, dat.all$diffQRPerDay[-nrow(dat.all)])), log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;notifs per QR code&quot;, 
     pch = 16, col = cols[dat.all$weekDay], main = &quot;raw data, one-day delay in notifications&quot;)</code></pre>
<p><img src="TAC_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>same day, 7-day average</li>
</ol>
<pre class="r"><code>plot(as.Date(dat.all$date), dat.all$diffNotifPerDay.WeekAve / dat.all$diffQRPerDay.WeekAve, log = &quot;&quot;,      
     xlab = &quot;date&quot;, 
     ylab = &quot;notifs per QRcode&quot;, 
     pch = 16, col = cols[dat.all$weekDay], main = &quot;7-day ave, same day&quot;)</code></pre>
<p><img src="TAC_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>one-day difference, 7-day average</li>
</ol>
<pre class="r"><code>par(mar = rep(5, 4), mgp = c(2, 0.3, 0), tck = -0.01)
colNotifsCas &lt;- &quot;#045a8d&quot;
plot(as.Date(dat.all$date), dat.all$diffNotifPerDay.WeekAve / (c(NA, dat.all$diffQRPerDay.WeekAve[-nrow(dat.all)])), log = &quot;&quot;,      
     xlab = &quot;&quot;, 
     ylab = &quot;nb de notifs par QR code&quot;, 
     pch = 16, col = colNotifsCas, 
     yaxs = &quot;i&quot;, frame.plot = FALSE, axes = FALSE)

title(&quot;Nb notifications par QR code, moy. 7j&quot;, line = 2.5)

# Annotate with dates
abline(v = as.Date(date_TAC), lty = 2)
cexAnnotate &lt;- 0.8
mtext(&quot;StopCovid -&gt; 
TousAntiCovid&quot;, side = 3, at = as.Date(date_TAC), adj = 1, cex = cexAnnotate)

abline(v = as.Date(date_sms), lty = 2)
mtext(&quot;envoi SMS 
QR code&quot;, side = 3, at = as.Date(date_sms), adj = 0, cex = cexAnnotate)

abline(v = as.Date(date_criteres), lty = 2)
mtext(&quot;nvx criteres
detection&quot;, side = 3, at = as.Date(date_criteres), adj = 0.7, cex = cexAnnotate)


abline(v = as.Date(date_criteres2), lty = 2)
mtext(&quot;nvx criteres
detection&quot;, side = 3, at = as.Date(date_criteres2), adj = 0.5, cex = cexAnnotate)

# mtext(&quot;Date&quot;, side = 1, line = 1.5)

for(i in seq(0.5, 1.5, by = 0.5)){
  abline(h = i, lty = 1, col = gray(0.8), lwd = 0.4)
}
mtext(paste0(&quot;Mise à jour : &quot;, Sys.Date(), &quot;
Données : https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/ pour TAC&quot;), cex = 0.55, col = gray(0.3), side = 1, line = 3.25, adj = 0, )

plotXaxs()
axis(2)
axis(4)</code></pre>
<p><img src="TAC_files/figure-html/NotifsPerQR-1.png" width="864" /></p>
</div>
</div>
<div id="epidemic-data" class="section level2">
<h2>Epidemic data</h2>
<p>Epidemic data, date is date at which result was communicated (and not sampling date).</p>
<pre class="r"><code>plot(dat.withEpi$date, dat.withEpi$P, col = cols[dat.withEpi$weekDay], pch = 16, 
     xlab = &quot;date&quot;, ylab = &quot;nb of cases&quot;)
lines(dat.withEpi$date, dat.withEpi$P.WeekAve, col = colAve)
legend(as.Date(&quot;2020-07-01&quot;), y = 65000, legend = c(names(cols),  &quot;7-day average&quot;), col = c(cols, colAve), pch = c(rep(16, 7), -1), box.lwd = 0, lwd = c(rep(0, 7), 1))</code></pre>
<p><img src="TAC_files/figure-html/EpidemicData-1.png" width="672" /></p>
</div>
<div id="active-users" class="section level2">
<h2>Active users</h2>
<p>Not all users are active; some people have downloaded the app but do not turn on bluetooth; some may just have downloaded the app for their “attestations”.<br />
To estimate the number of active users, we will compare the proportion of registered users in the whole population to the proportion of scanned QR codes among positive test results.</p>
<pre class="r"><code>par(xpd = TRUE)
# Approximate size of the French population
par(mar = c(5, 5, 5, 5))
par(mgp = c(2, 0.4, 0), tck = -0.01)
popFR &lt;- 67*10^6

# Registered users, as fraction of the total popuation
propUtil.Raw &lt;- dat.withEpi$register / popFR
propUtil &lt;- dat.withEpi$register.WeekAve / popFR

# Active users, averaged over a week
propUtilActif &lt;- dat.withEpi$diffQRPerDay.WeekAve / dat.withEpi$P.WeekAve


colActif &lt;- &quot;#83D905&quot;
colRegis &lt;- gray(0.4)
colActifPb &lt;- colActif#&quot;#9FA738&quot; # Simplification: ne pas montrer le donnees avec pbs doublons, car c&#39;etait de toute maniere minime
# Flagging problems in epi data
cols &lt;- rep(colActif, length(propUtilActif))
cols[idoublons] &lt;- colActifPb

  
cexPoints &lt;- 0.8 # Size of the dots
ymax &lt;- 100*ceiling(10*max(propUtil.Raw, na.rm = TRUE))/10

plot(dat.withEpi$date, 100*propUtilActif, 
     xlab = &quot;&quot;, ylab = &quot;Pourcentage d&#39;utilisateurs&quot;, ylim = c(0, ymax), 
     pch = 16, col = cols, 
       main = &quot;Pourcentage de la population utilisant TousAntiCovid (TAC)&quot;, 
     yaxs = &quot;i&quot;, frame.plot = FALSE, cex = cexPoints,
      axes = FALSE)
#mtext(&quot;Date&quot;, side = 1, line = 1.5)
plotXaxs()

# Add horizontal lines to read the values
par(xpd = FALSE)
for(i in seq(0.05, ymax, by = 5)){
  abline(h = i, lty = 1, col = gray(0.8), lwd = 0.4)
}

# Add points for raw users
points(dat.withEpi$date, 100*propUtil.Raw, pch = 16, col = colRegis, cex = cexPoints)

par(xpd = FALSE)

# Annotate with dates
cexAnnotate &lt;- 0.8
dx &lt;- 0.3
abline(v = as.Date(date_TAC), lty = 2)
mtext(&quot;StopCovid -&gt; 
TousAntiCovid&quot;, side = 3, at = as.Date(date_TAC), adj = 1-dx, cex = cexAnnotate)

abline(v = as.Date(date_sms), lty = 2)
mtext(&quot;envoi SMS 
QR code&quot;, side = 3, at = as.Date(date_sms), adj = dx, cex = cexAnnotate)

abline(v = as.Date(date_annonceMacron), lty = 2)
mtext(&quot;annonce pass
sanitaire&quot;, side = 3, at = as.Date(date_annonceMacron), adj = 1-dx, cex = cexAnnotate)

mtext(paste0(&quot;Mise à jour : &quot;, Sys.Date(), &quot;
Données : https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/ pour TAC, 
https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71 pour nb cas en date d&#39;annonce&quot;), cex = 0.55, col = gray(0.3), side = 1, line = 3.25, adj = 0)

legend(&quot;topleft&quot;, col = c(gray(0.4), colActif),#, colActifPb), 
       pch = 16, 
       legend = c(&quot;Utilisateurs enregistrés (brut)&quot;, &quot;Traçage : Pourcentage des cas du jour 
se signalant dans TAC (moy. 7j)&quot;), #, &quot;(qq pbs de doublons des données épidémiologiques)&quot;), 
       pt.cex = cexPoints, box.lwd = 0, cex = 0.9, bg = gray(1, 0.7), inset = c(0, 0.05))

axis(4)
axis(2)</code></pre>
<p><img src="TAC_files/figure-html/EstimateActiveUsers-1.png" width="672" /></p>
</div>
<div id="qr-codes-and-cases" class="section level2">
<h2>QR codes and cases</h2>
<p>Plot QR codes as function of cases, for <a href="https://twitter.com/TousAntiCovid/status/1390294629384441856?s=20">TAC twitter account</a></p>
<pre class="r"><code>par(mar = c(5, 5, 5, 5))
par(mgp = c(3, 0.75, 0))

ii &lt;- seq_len(nrow(dat.withEpi))/nrow(dat.withEpi)

# Flag epi data with issues
pchs &lt;- rep(16, nrow(dat.withEpi)+1)
pchs[idoublons] &lt;- 1


plot(c(0, dat.withEpi$P.WeekAve), c(0, dat.withEpi$diffQRPerDay.WeekAve), 
     type = &quot;l&quot;, 
     xlab = &quot;&quot;, 
     ylab = &quot;Nb de QR codes scannés (moy 7 j)&quot;, 
     xaxs = &quot;i&quot;, yaxs = &quot;i&quot;, frame.plot = FALSE, 
     main = &quot;QR codes scannés en fonction du nb de cas déclarés&quot;)
par(xpd = TRUE)
points(c(0, dat.withEpi$P.WeekAve), c(0, dat.withEpi$diffQRPerDay.WeekAve), col = rgb(1-ii, 0, ii), pch = pchs)

mtext(&quot;Nb de cas déclarés (moy 7j)&quot;, side = 1, line = 2)
par(xpd = FALSE)

cexdate &lt;- 1.5
i1 &lt;- which(dat.withEpi$date == date_TAC)
i2 &lt;- which(dat.withEpi$date == date_sms)
iend &lt;- nrow(dat.withEpi)-3


pts &lt;- c(i1, i2, iend)
points(dat.withEpi$P.WeekAve[pts], dat.withEpi$diffQRPerDay.WeekAve[pts], col = rgb(1-ii[pts], 0, ii[pts]), pch = 15, cex = cexdate)
text(dat.withEpi[pts, &quot;P.WeekAve&quot;], dat.withEpi[pts, &quot;diffQRPerDay.WeekAve&quot;], labels = c(&quot;StopCovid 
-&gt; TAC&quot;, &quot;Envoi SMS&quot;, toString(dat.withEpi$date[iend])), adj = c(0.5, 1.5))


mtext(paste0(&quot;Mise à jour : &quot;, Sys.Date(), &quot;
Données : https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/ pour TAC, 
https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71 pour nb cas en date d&#39;annonce&quot;), cex = 0.55, col = gray(0.3), side = 1, line = 3.25, adj = 0)</code></pre>
<p><img src="TAC_files/figure-html/QrcodesAsFuncCases-1.png" width="672" /></p>
</div>
<div id="app-settings" class="section level2">
<h2>App settings</h2>
<p>We want to see if the conditions to detect a contact have changed over time. If the app remains the same, the proportion of notified cases per QRcode should be a constant multiple of the proportion of app users. Notifications are sent to contacts of the 14? last days (maybe with decreasing proportion when the contact is older).</p>
<pre class="r"><code>par(mar = rep(5, 4))
# Notifications per QR code, 1-day delay, raw
notifsPerQR.raw.decalage &lt;- dat.all$diffNotifPerDay / (c(NA, dat.all$diffQRPerDay[-nrow(dat.all)]))

# Choice of the function over which cases are counted
prop.util &lt;- function(x){
  sliding.fun(x, FUN = max, winwdt = 7, pos = 7)
}

plot(as.Date(dat.all$date), notifsPerQR.raw.decalage / prop.util(propUtilActif),       
     xlab = &quot;&quot;, 
     ylab = &quot;Notif. par QR code / max(Prop. utilisateurs 7 derniers j.)&quot;, 
     main = &quot;&quot;, type = &quot;n&quot;, 
     yaxs = &quot;i&quot;, 
     frame.plot = FALSE, axes = FALSE)

plotXaxs()
axis(2)
axis(4)



title(&quot;Nb contacts détectés par utilisateur&quot;, line = 3)
mtext(&quot;(Estimation du nb notifs/QRcode si 100% utilisateurs)&quot;, line = 2, side = 3, cex = 0.8)
# Grid lines
# for(i in 0:65){
#   abline(h = i, col = gray(0.8))
# }
# for(i in seq(0, 65, by = 5)){
#   abline(h = i, col = gray(0.8), lwd = 2)
# }
for(i in seq(0, 65, by = 5)){
  abline(h = i, lty = 1, col = gray(0.8), lwd = 0.4)
}



# Annotate with dates
abline(v = as.Date(date_TAC), lty = 2)
cexAnnotate &lt;- 0.6
mtext(&quot;StopCovid -&gt; 
TousAntiCovid&quot;, side = 3, at = as.Date(date_TAC), adj = 1, cex = cexAnnotate)

abline(v = as.Date(date_sms), lty = 2)
mtext(&quot;envoi SMS 
QR code&quot;, side = 3, at = as.Date(date_sms), adj = 0, cex = cexAnnotate)

abline(v = as.Date(date_criteres), lty = 2)
mtext(&quot;nvx criteres
detection&quot;, side = 3, at = as.Date(date_criteres), adj = 0.7, cex = cexAnnotate)

abline(v = as.Date(date_criteres2), lty = 2)
mtext(&quot;nvx criteres
detection&quot;, side = 3, at = as.Date(date_criteres2), adj = 0.5, cex = cexAnnotate)


par(xpd = TRUE)
# Colors are flagging the duplicate problems
points(as.Date(dat.all$date), notifsPerQR.raw.decalage/prop.util(propUtilActif), pch = 16, col = cols)

points(as.Date(dat.all$date), notifsPerQR.raw.decalage/prop.util(propUtil.Raw), col = colRegis, pch = 16)
par(xpd = FALSE)


legend(&quot;topleft&quot;, col = c(&quot;white&quot;, colActif, #colActifPb, 
                          colRegis, &quot;white&quot;), pch = 16, 
       legend = c(&quot;prop. utilisateurs &quot;, &quot;Actifs&quot;, #&quot;Actifs, données avec pb doublons&quot;, 
                  &quot;Enregistrés&quot;), 
       box.lwd = 0, bg = gray(0, 0))


mtext(&quot;&quot;, side = 1, line = 1.5)

mtext(paste0(&quot;Mise à jour : &quot;, Sys.Date(), &quot;
Données : https://www.data.gouv.fr/fr/datasets/metriques-dutilisation-de-lapplication-tousanticovid/ pour TAC, 
https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71 
pour nb cas en date d&#39;annonce&quot;), cex = 0.55, col = gray(0.3), side = 1, line = 3.75, adj = 0)</code></pre>
<p><img src="TAC_files/figure-html/AppSettingsDetectedContacts-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
